<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Raffler</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-primary">
        <div class="container-fluid">
            <div class="navbar-brand text-light">Raffler</div>
            <div class="d-flex justify-content-end">
                <!-- Add reset entries button -->
                <button class="btn btn-outline-light me-2" type="button" onclick="resetEntries()">Reset Entries</button>
                <button class="btn btn-outline-light" type="button" onclick="resetRaffle()">Reset</button>
            </div>
        </div>
    </nav>
    <div class="container-fluid m-0 mt-4">
        <div class="row mb-3">
            <div class="col-12 col-md-6">
                <div class="input-group">
                    <input id="name-input" type="text" class="form-control" placeholder="Name" aria-label="Name"
                        aria-describedby="add-button">
                    <button class="btn btn-outline-secondary" type="button" id="add-button"
                        onclick="addParticipant()">Add</button>
                </div>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col">
                <button class="btn btn-primary" type="button" onclick="pickAWinner()">Pick a winner</button>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <ul class="list-group">
                    <!-- List items will be dynamically added here -->
                </ul>
            </div>
        </div>
    </div>

    <template id="list-item-template">
        <li class="list-group-item">
            <span id="name"><!-- Name will be dynamically added here --></span>
            <button id="delete" class="btn btn-danger float-end" onclick="deleteParent(event)">Delete</button>
            <div class="input-group float-end me-2" style="width: unset; max-width: 100%;">
                <button id="subtract" class="btn btn-danger" onclick="subtractEntry(event)">-</button>
                <input type="number" class="form-control" value="0" onchange="changeEntry(event)">
                <button id="add" class="btn btn-success" onclick="addEntry(event)">+</button>
            </div>
        </li>
    </template>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <script>
        const participants = [];

        const nameInput = document.querySelector('#name-input');
        nameInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                addParticipant();
            }
        });

        const deleteParent = (event) => {
            const button = event.target;
            const parent = button.parentElement;
            const name = parent.querySelector('#name').innerText;
            if (confirm(`Are you sure you want to remove ${name}?`)) {
                const index = participants.findIndex((item) => item.name === name);
                participants.splice(index, 1);
                parent.remove();
                console.log(participants);
            }
        }

        const subtractEntry = (event) => {
            const button = event.target;
            const parent = button.parentElement;
            const grandParent = parent.parentElement;
            const name = grandParent.querySelector('#name').innerText;
            const index = participants.findIndex((item) => item.name === name);
            if (participants[index].entries > 0) {
                participants[index].entries--;
                parent.querySelector('input').value = participants[index].entries;
                console.log(participants);
            }
        }

        const addEntry = (event) => {
            const button = event.target;
            const parent = button.parentElement;
            const grandParent = parent.parentElement;
            const name = grandParent.querySelector('#name').innerText;
            const index = participants.findIndex((item) => item.name === name);
            participants[index].entries++;
            parent.querySelector('input').value = participants[index].entries;
            console.log(participants);
        }

        const changeEntry = (event) => {
            const input = event.target;
            const parent = input.parentElement;
            const grandParent = parent.parentElement;
            const name = grandParent.querySelector('#name').innerText;
            const index = participants.findIndex((item) => item.name === name);
            participants[index].entries = parseInt(input.value);
            console.log(participants);
        }

        const addParticipant = () => {
            const name = nameInput.value;
            if (name === '') {
                alert('Please enter a name.');
                return;
            }
            if (participants.some((participant) => participant.name === name)) {
                alert(`${name} is already added.`);
                nameInput.value = '';
                return;
            }
            const participant = {
                name,
                entries: 0
            };
            participants.push(participant);
            nameInput.value = '';

            const template = document.querySelector('#list-item-template');
            const listItem = template.content.cloneNode(true);
            const listGroupItem = listItem.querySelector('.list-group-item');
            listGroupItem.querySelector('#name').innerText = name;

            document.querySelector('.list-group').appendChild(listItem);
            console.log(participants);
        };

        const resetRaffle = () => {
            if (confirm('Are you sure you want to reset?')) {
                list.innerHTML = '';
                participants.length = 0;
            }
        };

        const resetEntries = () => {
            if (confirm('Are you sure you want to reset entries?')) {
                for (const participant of participants) {
                    participant.entries = 0;
                }
                const entriesInputs = document.querySelectorAll('input');
                for (const entriesInput of entriesInputs) {
                    entriesInput.value = 0;
                }
            }
        };

        const pickAWinner = () => {
            const totalEntries = participants.reduce((total, participant) => {
                return total + participant.entries;
            }, 0);
            const winningNumber = Math.floor(Math.random() * totalEntries);
            let currentTotal = 0;
            for (const participant of participants) {
                currentTotal += participant.entries;
                if (currentTotal > winningNumber) {
                    alert(`${participant.name} is the winner!`);
                    break;
                }
            }
        }
    </script>
</body>

</html>